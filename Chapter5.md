# Chapter 5
## 概念
### CNCF（云原生基金会）云原生的定义
云原生技术有利于各组织在公有云、私有云和混合云等新型动态环境中，构建和运行可弹性扩展的应用。云原生的代表技术包括容器、服务网格、微服务、不可变基础设施和声明式 API
![image](https://github.com/user-attachments/assets/608ee15c-fe96-42f9-becb-d1a90beebe8b)

### 云原生主要应用领域
这些技术能够构建容错性好、易于管理和便于观察的松耦合系统。结合可靠的自动化手段，云原生技术使工程师能够轻松地对系统作出频繁和可预测的重大变更

### 云原生主要技术领域
容器及资源编排管理、DevOps、应用交付于运维、微服务及治理。

### 云原生解读
可以从以下三个维度对云原生进行解读
1. 可编程的、动态的基础设施：支持公有云、私有云，边缘云等
2. 创新的软件开发和交付方式：基于自动化、可观测、可管理的软件交付流程
3. 分布式应用（服务）架构：具备松耦合，弹性扩展，高容错等特点

## 云原生技术设施
Gartner将云原生基础设施划分为四大类
1. 模块化程度越来越高 ：自包含的应用打包方式，应用与底层物理基础设施解耦。
2. 自动化运维程度越来越高 ：自动化的资源调度和弹性伸缩能力，用户将关注点逐渐聚焦到应用自身。
3. 弹性效率越来越高 ：VM 可以实现分钟级扩容；容器可以实现秒级扩容；函数可以做到毫秒级扩容。
4. 故障恢复能力越来越高 ：随着系统自愈性的增强，大大简化了应用架构容错的复杂性

![image](https://github.com/user-attachments/assets/775df9ac-6e00-4a1e-8d93-132816dff6a5)

| 分类 | IaaS | CaaS | Serverless容器 | fPaaS/FaaS |
|:----:|:----:|:----:|:---------------:|:----------:|
| 代表产品 | ECS | K8s服务 | K8s托管服务容器计算实例 | 函数计算 |
| 虚拟化技术 | 硬件虚拟化 | 操作系统虚拟化 | MicroVM | 容器或应用运行时虚拟化 |
| 应用交付 | 虚拟机镜像+自动化脚本 | 容器镜像 | 容器镜像 | 应用代码 |
| 应用兼容性&灵活性 | 高 | 中 | 中 | 低 |
| 扩容单位 | 虚拟机 | Pod | Pod | 函数实例 |
| 弹性效率 | 分钟级 | 秒级 | 秒级 | 毫秒级 |

## 云原生的优势
云原生技术体系出现且快速被接受和广泛应用是由云计算的经济学基础和核心竞争力决定的。
1. 云计算的经济学基础和商业模式来自规模经济，亚当斯密：“分工是社会发展的必然，而且分工将极大地提高生产效率”
2. 云计算是平台型业务模式的技术先决条件
3. 云计算的核心技术创新加速规模效应的形成

### 云计算和云原生的优势
#### 分工与规模经济
软硬一体设计，可以针对规模和性能进行全栈优化，极大降低计算成本。而且由于云计算的规模效应，随着产量的增加，边际成本会拉低平均制造成本。全球主流云厂商都在 IDC 设计、网络、芯片等方向加大自研投入。

#### 平台型业务模式
以 API 方式交付 IT 能力，一方面可编程的基础设施极大提升了 IT 的敏捷性，更好地支持业务敏捷性；一方面 API 可以更加方便地被集成到三方服务商的解决方案中，进一步加速规模效应产生。

#### 效率与创新
随着 IT 能力的规模化，一些数据化、智能化的创新技术和业务模式逐渐形成。比如 ECS 宕机预测和自动热迁移，可以将虚拟机的 SLA 提升到传统需要硬件冗余才能达到的稳定性标准；RDS 对数据库的自动优化和问题诊断，无需DBA 的人力过多介入。

#### 应用部署与交付与底层资源解耦
容器技术提供了一个优雅的抽象，让开发所需要的灵活性、开放性和运维所关注的标准化、自动化达成平衡。彻底解耦了应用和运行时环境，可以帮助应用更加快速平滑地迁云；容器轻量化、自包含的特性极大简化了应用弹性，释放云的核心价值。

#### 更多技术被标准化下沉到平台层
容器技术的标准化促进生态的分工和协同。基于 Kubernetes，社区开始构建上层的业务抽象。比如，服务网格 Istio、机器学习平台 Kubeflow 以及无服务器应用框架 Knative 等等。通过这样的架构分层，进一步降低了技术门槛，加速了云价值释放。

#### 技术创新加速对业务拉动作用突出
作为云原生技术的演进，无服务器计算（Serverless）进一步释放了云计算的能力，将弹性伸缩、高可用、安全等需求由基础设施实现。Serverless 应用可以迅速弹性伸缩，用户无需进行容量规划；采用按需付费的模型，用户只按应用实际消耗的资源付费。

### 如何拥抱云原生
从“托管模式”、“新建模式”到“重构模式”，我们可以看到迁移的成本和复杂性在增加，但是敏捷性、弹性、可用性、容错性等收益也在持续增加。云原生已经成为势不可挡的技术趋势。在 CNCF 2020 年发布的《云原生开发状态报告》中，我们可以看到全球有 470 万云原生开发者，占全部后端开发者的 36%，其中包括 290 万使用容器技术以及 330万使用 Serverless 架构的开发人员。
![image](https://github.com/user-attachments/assets/2db7697f-78b7-4789-b0c6-5339fb7d6506)

*Tips：  
托管模式：将线下物理机替换成为云上虚拟机或裸金属实例，不改变原有的运维方式。  
新建模式：利用托管的云服务替换线下自建应用基础设施，比如通过 RDS 数据库服务替换自建 MySQL；通过容器服务，比如阿里云 ACK 来取代自建 K8s 集群。托管的云服务通常提供更好的弹性、稳定性和自治运维能力，可以让用户关注于应用而非基础设施管理。  
重构模式：包括单体应用的分布式改造，按需进行微服务改造，应用的容器化封装和Serverless化等*

### 云原生未来趋势
#### 概览
##### 无处不在的计算催生新一代容器实现
针对计算场景优化、安全、轻量、高效  
*公有云服务能力将延伸到边缘云和IDC             
*基于MicroVM的安全容器  
*基于软硬一体设计的机密计算容器  			   
*基于WebAssembly的可移植、轻量容器  
*OS虚拟化创新，如cgroupv2提升隔离性

##### 云原生操作系统开始成熟
定义开放标准，向下封装资源，向上支持应用  
*计算、存储、网络、安全的云原生进化  
*多种工作负载，海量计算任务，多种异构算力的高效调度和编排  
*标准化、自动化、可移植、安全可控的应用交付、管理体系

##### 在云端，Serverless技术逐渐融入主流  
极致弹性，免运维，强安全，高效开发  
*与云深度融合，复杂性下沉，极致弹性  
*新的应用开发， 交付范式开始形成  

##### 动态、混合、分布式的云环境将成为新常态  
统一技术栈，统一应用界面，统一管理界面  
*公有云服务能力将延伸到边缘云和IDC  
*云原生架构推进无边界云计算，促成云边端应用一体协同  

#### 催生新一代容器实现
1988年，Ubiquitous Computing被提出——“在未来，计算将无处不在”，5G和AIoT的出现，已经成为现实，针对不同计算场景，容器运行时有不同的需求，RunC/Docker容器可以满足大部分业务需求

KataContainer、Firecracker、gVisor，Unikernel在RunC的基础之上增强了容器运行时的安全隔离能力
但是没有一种容器技术可以在安全隔离性、执行效率和通用性上做到完美
OCI（Open Container Initiative）标准对不同的运行时进行标准化的容器生命周期管理，进一步促进了容器引擎技术的持续创新

未来的几个主要趋势：  
基于MicroVM的安全容器的占比将逐步增加，额可以提供更高的安全隔离能力  
基于软硬一体设计的机密计算容器开始发力  
OS的虚拟化创新在持续进度  
WebAssembly是新一代可移植、轻量化的应用虚拟机  

#### 云原生操作系统开始成熟
Kubernetes 已经成为云时代的操作系统。我们可以对比一下经典的 Linux 和 Kubernetes 的概念模型，他们都是定义了开放的、标准化的访问接口；向下封装资源，向上支撑应用  

它们都提供了对底层计算、存储、网络、异构计算设备的资源抽象和安全访问模型。可以根据应用需求进行资源调度和编排。Linux 的计算调度单元是进程，调度范围限制在一台计算节点。而 Kubernetes 的调度单位是 Pod，可以在分布式集群中进行资源调度，甚至跨越不同的云环境  

在初期，Kubernetes 上主要运行着无状态的Web 应用。随着技术的成熟和社区的发展，我们看到更多的有状态应用和大数据 /AI 应用负载逐渐迁移到 K8s 上。  

统一技术栈提升资源利用率：多种计算负载在K8s 集群统一调度，可以有效提升资源利用率。 

统一技能栈降低人力成本：K8s 可以在 IDC、云端、边缘等不同场景进行统一部署和交付。云原生提倡的 DevOps 文化和工具集可以有效提升技术迭代速度，整体上降低人力成本。  

#### 云原生操作系统开始应用于多个关键应用领域
在初期，Kubernetes 上主要运行着无状态的 Web 应用。随着技术的成熟和社区的发展，我们看到更多的有状态应用和大数据 /AI 应用负载逐渐迁移到 K8s 上。   

统一技术栈提升资源利用率：多种计算负载在 K8s 集群统一调度，可以有效提升资源利用率。  

统一技能栈降低人力成本：K8s 可以在 IDC、云端、边缘等不同场景进行统一部署和交付。云原生提倡的 DevOps 文化和工具集可以有效提升技术迭代速度，整体上降低人力成本。  

加速数据服务的云原生化：由于计算存储分离具备巨大的灵活性和成本优势，数据服务的云原生化也逐渐成为趋势。AI 模型训练和大数据计算类工作负载需要 K8s 提供更低的调度延迟、更大的并发调度吞吐和更高的异构资源利用率。

![image](https://github.com/user-attachments/assets/8b94dfe4-aa70-4e6e-9a91-acba55fcaa08)

#### Serverless技术
除了 FaaS 的快速发展，Serverless 和容器技术也开始融合，尤其是得到了云厂商的高度关注。通过 Serverless 容器，一方面可以根本性解决 K8s 自身的复杂性，让用户无需受困于 K8s 集群容量规划、安全维护、故障诊断等运维工作；另一方面进一步释放了云计算的能力，将安全、可用性、可伸缩性等需求下沉到基础设施实现，可以帮助云厂商形成差异化竞争力  

在 Gartner 在 2020 年 Public Cloud Container Service Market 评估报告中把 Serverless 容器作为云厂商容器服务平台的主要差异化之一，其中将产品能力划分为 Serverless 容器实例和 Serverless Kubernetes 两类。  

目前业界所有公有云厂商都推出了 Serverless 容器产品，除阿里云 ASK/ECI 外，还包括 AWS Fargate, Azure、ACI，华为 CCI，腾讯 EKS, GCP CloudRun 等。  

Serverless 容器可以和 FaaS 形成良好的互补。Serverless 容器支持容器镜像作为应用载体，支持各种类型应用，比如无状态应用、有状态应用、计算任务类应用等。大量用户现有的应用无需修改即可部署在 Serverless Container 环境中  

Serverless 容器业界标准未定，云厂商有很多空间通过技术创新提供独特的增值能力，云厂商的后续工作主要是：  
扩展 Serverless 容器应用场景和产品组合，迁移更多普通容器 workload 到 Serverless 容器服务。  
推进 Serverless 容器的标准化，减轻用户对云厂商锁定的担忧

#### 动态、混合、分布式的云环境将成为新常态
Gartner预测“2021年，超过75%的大中型组织将采用多云或混合IT战略”

2019 年 Google 推出 Anthos 多云应用平台，其基础就是 GKE K8s 托管服务。

微软在 Build 2020 会议上宣布了 Azure Arc 支持 Kubernetes 集群的预览版。微软 CEO 萨蒂亚·纳德拉将 Azure Arc 描述为混合云计算的控制平面，可以统一管理云上、边缘和 IDC 中运行的 Kubernetes 集群，以及 Windows 和Linux 服务器实例。

阿里云容器服务 ACK 去年 9 月份发布了混合云 2.0 架构，提供了完备的混合云 K8s 管理能力。

多厂商的解决方案或产品的实质：通过向客户提供横跨本地私有云、公有云的K8s集群服务来实现云原生资源层的互通和应用服务的互通，最终实现分布式的混合云整体服务

技术原理：有一个综合的多K8s集群的分布式管理面，管理在多种云资源上的K8s容器集群以及这些集群之上的应用或服务

#### 总结
云原生基础设施是承载云原生应用的软硬件资源集合，容器是云原生基础设施的核心技术。由于容器技术本身兼具资源属性和应用属性，因此云原生基础设施也跨越了传统云计算的IaaS和PaaS边界。

云原生计算加速了应用和基础资源的解耦，充分释放云的弹性；通过关注点分离，让开发者关注业务价值，而复杂性下沉到基础设施。对企业而言，云原生计算可以帮助企业优化云架构，最大化发挥云价值。

在 IaaS 层面云原生基础设施包括基于容器技术体系构建的云原生计算、云原生存储和云原生网络资源

在 PaaS 层面，云原生基础设施又 包括基于容器及其编排能力构建的各类云原生 PaaS 服务，包括云原生CI/CD、云原生数据库、 服务网格、无服务器服务、云原生 AI 服务等能力和服务。

![云原生基础设施技术体系](https://github.com/user-attachments/assets/e8821cfd-f15c-4eca-ba44-a5cbfd47e999)









