![image](https://github.com/user-attachments/assets/dffb7b91-beb4-4444-ab86-3ca7e5099a09)# Chapter 3
## 应用平台及核心技术
### PaaS
#### Paas基本概念
定义：平台即服务（Platform as a Service）或应用程序平台即服务（aPaaS，application PaaS）或基于平台的服务（platform based service）是一类云服务计算，它提供了一个平台，允许客户开发、运行和管理应用程序，而无需构建和维护通常与开发和启动应用程序相关的复杂的基础架构。 

类型：从功能上，PaaS平台通常包括：应用的开发交付平台，如Devops平台；应用的部署运行平台，如Kubernetes；各类中间件平台，比如数据库、消息中间件、缓存等；特定功能的管理运维平台，如监控告警平台、日志平台、服务治理平台等。  

交付模式：从交付形态上包括了公有云PaaS、私有云PaaS和混合云PaaS  

定位：与IaaS，SaaS的关系如下图所示
![image](https://github.com/user-attachments/assets/db43ca14-3c64-4ab5-b12a-2085e2b91a77)

热点与趋势：基于云原生技术栈的通用PaaS平台

![image](https://github.com/user-attachments/assets/2796a4fa-5f95-4d42-bc97-5ed212c36c6e)

### DevOps
DevOps是企业应对数字化过程中多重挑战的方法论
<table>
	<tr>
		<td align="left"  rowspan="2">企业在数字化过程中遇到的挑战</td>
		<td align="left" >交付频率高，研发周期短</td>
    <td align="left" >需跨地域协作，部署发布复杂化	</td>
    <td align="left" >可靠性及安全性要求高</td>
	</tr>
	<tr>
		<td align="left" >特性交付缩短到以天为单位<br>版本交付缩短到以周为单位<br>快速交付、快速反馈</td>
    <td align="left" >跨地域协作沟通增多、效率低下<br>研发、测试、生成环境不一致<br>多地域部署</td>
    <td align="left" >7X24小时运行，可靠性要求高<br>混合云、多云战略导致核心研发数据传输与存储上存在风险</td>
	</tr>
  	<tr>
		<td align="left" >研发模式持续创新</td>
		<td align="left" >瀑布型开发</td>
    <td align="left" >敏捷开发</td>
    <td align="left" >DevOps</td>
	<tr>
</table>

#### DevOps概念
定义：DevOps（Development和Operations）的组合词，是一种重视“软件开发人员（Dev）”和“IT运维技术人员（Ops）”之间沟通合作的文化、运动或惯例。透过自动化“软件交付”和“架构变更”的流程，来使得构建、测试、发布软件能够更加快捷、频繁和可靠。  
目标：DevOps的目标是工程效率最大化，它本身只是一种方法论，是为了实现工程效率最大化的目标而存在的。

亚马逊DevOps观点  
DevOps侧重于改善写作，沟通，整合软件开发与IT运维。是一个总称，用来描述一种理念、文化变革和模式转变。  
DevOps帮助亚马逊从软件开发敏捷走向业务和运维的敏捷。  
开发阶段，DevOps重点放在代码构建、代码覆盖、单元测试、打包和部署；运维阶段，在基础设施上聚焦环境分配、配置、编排和部署。  

微软DevOps观点  
DevOps不仅是一项技术或工具集，也是观念和文化的转变。它结合人、流程、适当的工具，使应用程序生命周期管理更快、更可预测。  
我们应将DevOps视为过程而非目的，应当选定合适范围的项目，增量式实施，通过这些项目展示成功、学习，并演进。  

#### DevOps生命周期过程
![image](https://github.com/user-attachments/assets/0fcfac62-9016-4742-b654-093e1f9cce46)
DevOps它不仅仅体现在流程上打通了软件开发的整个生命周期，它还包括以下五个要素：  
第一是文化：DevOps与传统职能型团队不同，它的前提是建⽴一体化的全功能团队，打破开发(Dev)与技术运营(Ops)隔阂，形成DevOps的协同合作的文化氛围  
第二是自动化：自动化一切可以自动化的，通过自动化的工具或脚本实现软件工程从构建到运维过程的自动化流水线作业。  
第三是精益：以精益的⽅式⼩步快跑，持续改善。  
第四是度量：建⽴有效的监控与度量手段快速获得反馈，推动产品和团队的持续改进，测试驱动开发、增量式开发这些实践都是为了获得有效反馈并作用于下一次迭代周期中。  
第五是分享：不同职能、不同产品之间经验分享能够促进DevOps的文化沉淀，促进产品迭代和更新。  

#### DevOps平台
DevOps平台能够提供从需求、开发、测试、发布、运维、运营端到端的协同服务和研发工具，通过研发综合效能管理和专项自动化提效工具，能够提升研发效能、降低研发成本，支撑技术团队实现真正的CI/CD和独立交付。一个完整的DevOps平台，通常包含如下几方面的能力。
![image](https://github.com/user-attachments/assets/3aa210c7-fa05-4154-a0cd-ddd2519d135c)
项目协作：敏捷开发团队提供简单高效的团队协作服务，包含多项目管理、敏捷迭代、 看板协作、需求管理、缺陷跟踪、文档管理、Wiki在线协作、仪表盘自定制报表等功能。

代码托管：为软件开发者提供基于Git的在线代码托管服务，包括代码克隆/下载/提交/推送/比较/合并/分支/Code Review等功能。

代码检查：基于云端实现代码质量管理的服务，软件开发者可在编码完成后执行多语言的代码静态检查和安全检查，获取全面的质量报告，并提供缺陷的改进建议和趋势分析，有效管控代码质量，降低解决成本。

测试管理：面向软件开发者提供的一站式测试平台，覆盖测试管理、接口测试、性能测试，融入DevOps敏捷测试理念，实现高效管理测试活动，保障产品高质量交付。

编译构建：基于云端大规模并发加速，提供高速、低成本、配置简单的混合语言构建能力，缩短构建时间，提升构建效率。

应用部署：提供可视化、一键式部署服务，支持并行部署和流水线无缝集成，支持脚本部署，虚拟机部署，容器部署等部署类型，支持java、node.js、python等多种技术栈，实现部署环境标准化和部署过程的自动化。

应用仓库：支持容器镜像全生命周期管理的服务， 提供简单易用、安全可靠的镜像管理功能，支持快速部署容器化应用。

应用运行平台：高可靠高性能的应用承载与管理，对于容器化应用一般要求支持Kubernetes社区原生应用和工具，提供基于Kubernetes的容器化运行环境。

### 微服务及其治理平台
#### 从单体走向微服务
| 单体架构 | 微服务化改造 | 微服务架构 |
|:-------|:-----------|:---------|
| 代码越来越庞大、臃肿<br>功能模块紧耦合<br>越来越难以改进和重构<br>无法快速开发和迭代<br>无法应用新技术 | 单体拆分成多个独立的微服务<br>服务间通过RESTful接口或RPC等松耦合方式调用<br>各服务独立开发、独立部署<br>每个服务对应独立的后端存储 | 代码轻量易维护<br>功能模块松耦合<br>并行开发、快速迭代<br>独立部署和升级运维<br>独立开发栈、快速应用新技术 |

|![image](https://github.com/user-attachments/assets/910d16d1-f34f-4314-a0e0-90497d37ee74)|![image](https://github.com/user-attachments/assets/0eb181ec-81cd-4a05-86df-e8dec93db432)|
|:---:|:----:|

#### 微服务的挑战
微服务可以带来应用开发、迭代效率的巨大提升，但实施微服务也存在巨大挑战，总体分为技术挑战和非技术挑战：  
技术挑战：
|服务间通信|SLA与可靠性|数据协调与一致性|可观察性|安全性|持续交付|资源竞争与分配|
|:---|:---|:---|:---|:---|:---|:---|
|服务间如何进行通信和功能调用<br>如何获取服务访问入口<br>多个服务如何做负载均衡|如何控制流量保证服务可靠性<br>如何快速响应或超时<br>单个服务故障如何处理不让整个服务链崩溃<br>如何保证多次服务调用是幂等的	|如何实现分布式事务<br>微服务数据散落在多个后端，如何实现数据的汇聚与协调|调用链太长，如何快速排查异常问题<br>海量动态服务如何进行监控和日志采集|大量服务互访如何做身份认证<br>如何进行访问权限控制<br>流量是否需要加密|大量服务如何做版本管理<br>微服更强调自动化的交付流程<br>大量服务的在线集成如何保证可靠和稳定|如何为多类服务做资源配额<br>如何为单个服务做资源限制|

非技术挑战：  
|集约化运营|微服务拆分|团队间的有效协调|
|:---|:---|:---|
|大量微服务，技术栈、发布、运行、运维方式各不相同，对运维/运营带来极大难度，必须实现承载、|如何对单体进行合理拆分，既保证业务的灵活性又能有效协同<br>如何确定服务的边界|微服务通常由独立团队负责，服务间互相依赖，如何协调彼此需求<br>如何协调进行多个微服务的集成测试|

#### 微服务和容器技术
容器技术是应用微服务化改造成功的必备能力，其对微服务的意义主要体现在两方面：  
1. 基于容器和kubenetes构建云原生基础设施实现微服务应用的标准化、集约化承载与管控，极大提升运维/运营效率；
2. 容器技术为微服务提供标准化交付方式，可极大提升应用的交付管理能力。

##### 标准化交付方式
容器镜像是组件的标准交付格式  
基于kubernetes提供的应用部署能力构建标准的应用交付能力，如helm、knative等

##### 集约化承载与管控
服务管理能力，服务发现与注册  
健康检查、异常迁移、副本保持等服务自愈能力  
统一的应用编排能力，实现微服务部署的统一管控  
统一资源调度能力，高效协调和分配资源  
资源统一抽象、屏蔽底层资源架构差异，标准化承载
![image](https://github.com/user-attachments/assets/63e8853a-e030-4323-a17b-abec347e2bec)

#### 微服务及治理技术
容器技术可以部分解决微服务带来的技术和管理方面的挑战，但其作为通用技术，本质上解决的大量应用的统一承载、管控问题。本节针对微服务这一特定技术领域，对其技术核心关注点和代表性微服务框架进行整体分析。
| 功能 | Spring Cloud | Istio + Kubernetes |
|:----:|:------------:|:------------------:|
| 服务间通信 | Spring RestTemplate | 语言框架无关，RPC、RESTful、异步消息 |
| 服务发现和LB | Netflix Eureka、Netflix Ribbon/Feign | k8s service、sidecar-envoy |
| 自愈和自动伸缩 | 无 | k8s自愈能力、HPA、VPA |
| 调度和隔离 | 无调度；断路器 Netflix Hystrix | k8s资源调度、资源配额、熔断限流、容器 |
| 测试和发布 | 无 | 故障注入、A/B测试、蓝绿发布、流量镜像 |
| API管理 | API Gateway、Netflix Zuul | API Gateway、envoy、kong |
| metrics和日志 | Spring Boot Admin | Prometheus、EFK |
| 调用链监控 | Sleuth + Zipkin | Zipkin、Jaeger |
| 配置管理 | Spring Cloud Config | ConfigMap、Secret |
| 服务安全 | Spring Security | Auth2.0、RBAC权限、TLS流量加密 |

![微服务的重点关注技术](https://github.com/user-attachments/assets/3561eb6a-9934-43cd-8973-d05747e1827d)

#### 微服务治理方案
Spring Cloud、Kubernetes、Istio的融合既是技术发展的趋势，也是构建微服务及其治理平台的可行性选择。kuberntes代表了“云原生”和“业务上云”的基本方向；Spring Cloud支撑的是工业界业务应用开发的绝对主流-java技术栈；Istio是服务治理的下一代框架，提供了平台级的服务治理能力。
下表分析了两类主流框架的优劣；图1 给出了两类框架的融合架构，以及作为通用PaaS能力的集成方案。


![微服务治理平台融合架构](https://github.com/user-attachments/assets/c623fe09-85c4-4c56-bf8f-903d198f5b4a)



















	






















